'use client'

import {useRouter, useSearchParams} from 'next/navigation'
import {Suspense, useEffect} from 'react'
import Link from "next/link";
import axios from "@/lib/axios";
import {useAuthContext} from "@/context/auth/hooks";
import {Button} from "@/components/ui/button";


const VerifyPage = () => {
    return (
        <Suspense fallback={<div>Loading...</div>}>
            <div className={'w-full h-full flex items-center justify-center'}>
                <VerifyComponent/>
            </div>
        </Suspense>
    );
};

const VerifyComponent = () => {
    const router = useRouter()
    const searchParams: any = useSearchParams()
    const {user}: any = useAuthContext()
    useEffect(() => {
        if (user) {
            const formData = new FormData()
            formData.append('trackId', searchParams.get('trackId'))
            formData.append('order_id', searchParams.get('orderId'))

            if (parseInt(searchParams.get('success'))) {
                const TransactionVerify = async () => {
                    await axios.post('transactions/verify', formData)
                }
                TransactionVerify()
            }
        }

        setTimeout(() => {
            router.push('/profile')
        }, 5000)


    }, [user]);

    return (
        <div className={'max-w-[100vw] overflow-hidden w-full flex items-center justify-center mt-16 mb-10 p-9'}>

            <div
                className={'flex flex-col items-center justify-center bg-white p-3 gap-y-4 rounded-[8px] shadow-xl'}>
                {!!parseInt(searchParams.get('success')) ?

                    <div className={'flex flex-col items-center justify-center gap-y-10 px-40 py-10'}>
                        <div>
                            {parseInt(searchParams.get('success')) === 1 && <SuccessPayIcon/>}
                            {parseInt(searchParams.get('success')) === 0 && <FailedPayIcon/>}
                        </div>
                        <span
                            className={`text-2xl sm:text-3xl font-bold 
                        ${parseInt(searchParams.get('success')) === 1 && 'text-success'}
                        ${parseInt(searchParams.get('success')) === 0 && 'text-error'}
                         `}>
                        {parseInt(searchParams.get('success')) === 1 && 'پرداخت با موفقیت انجام شد'}
                            {parseInt(searchParams.get('success')) === 0 && 'پرداخت ناموفق'}
                    </span>
                    </div>
                    :
                    <h1>
                        شما به این صفحه دسترسی ندارید
                    </h1>

                }
                <Link href={'/profile'}>
                    <Button variant="outline">
                        در حال انتقال به صفحه ی کاربری ...
                    </Button>
                </Link>

            </div>


        </div>
    );
};
const SuccessPayIcon = () => (
    <svg width="250" height="250" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clipPath="url(#clip0_2212_1655)">
            <path
                d="M25 12.5C24 19 19.6274 24.5 13 24.5C5 23.5 3 20 1 12.5C3.5 4.5 6 3.5 13 1C21.5 3 23 6.5 25 12.5Z"
                fill="#5CB85C"/>
            <path fillRule="evenodd" clipRule="evenodd"
                  d="M16.8253 9.98773C16.901 10.0632 16.961 10.1529 17.002 10.2516C17.0429 10.3503 17.064 10.4561 17.064 10.563C17.064 10.6698 17.0429 10.7757 17.002 10.8744C16.961 10.9731 16.901 11.0628 16.8253 11.1382L11.9503 16.0132C11.8748 16.0889 11.7852 16.1489 11.6865 16.1899C11.5877 16.2308 11.4819 16.2519 11.3751 16.2519C11.2682 16.2519 11.1624 16.2308 11.0636 16.1899C10.9649 16.1489 10.8753 16.0889 10.7998 16.0132L8.3623 13.5757C8.28676 13.5002 8.22683 13.4105 8.18595 13.3118C8.14507 13.2131 8.12402 13.1073 8.12402 13.0005C8.12402 12.8936 8.14507 12.7879 8.18595 12.6892C8.22683 12.5905 8.28676 12.5008 8.3623 12.4252C8.43784 12.3497 8.52753 12.2898 8.62623 12.2489C8.72493 12.208 8.83072 12.1869 8.93755 12.1869C9.04438 12.1869 9.15017 12.208 9.24887 12.2489C9.34758 12.2898 9.43726 12.3497 9.5128 12.4252L11.3751 14.2891L15.6748 9.98773C15.7503 9.91206 15.8399 9.85203 15.9386 9.81107C16.0374 9.77011 16.1432 9.74902 16.2501 9.74902C16.3569 9.74902 16.4627 9.77011 16.5615 9.81107C16.6602 9.85203 16.7498 9.91206 16.8253 9.98773Z"
                  fill="black"/>
            <path
                d="M16.6943 4.08427L15.1976 2.55027L16.3595 1.41602L17.3703 2.45115L18.8165 2.43327C19.4426 2.42586 20.0637 2.5437 20.6436 2.77986C21.2234 3.01602 21.7501 3.36574 22.1928 3.80844C22.6355 4.25114 22.9853 4.77789 23.2214 5.35772C23.4576 5.93755 23.5754 6.55874 23.568 7.18477L23.5518 8.63102L24.5853 9.64177C25.0329 10.0792 25.3886 10.6016 25.6314 11.1784C25.8742 11.7553 25.9993 12.3748 25.9993 13.0006C25.9993 13.6265 25.8742 14.246 25.6314 14.8228C25.3886 15.3997 25.0329 15.9221 24.5853 16.3595L23.5501 17.3703L23.568 18.8165C23.5754 19.4426 23.4576 20.0637 23.2214 20.6436C22.9853 21.2234 22.6355 21.7501 22.1928 22.1928C21.7501 22.6355 21.2234 22.9853 20.6436 23.2214C20.0637 23.4576 19.4426 23.5754 18.8165 23.568L17.3703 23.5518L16.3595 24.5853C15.9221 25.0329 15.3997 25.3886 14.8228 25.6314C14.246 25.8742 13.6265 25.9993 13.0006 25.9993C12.3748 25.9993 11.7553 25.8742 11.1784 25.6314C10.6016 25.3886 10.0792 25.0329 9.64177 24.5853L8.63102 23.5501L7.18477 23.568C6.55874 23.5754 5.93755 23.4576 5.35772 23.2214C4.77789 22.9853 4.25114 22.6355 3.80844 22.1928C3.36574 21.7501 3.01602 21.2234 2.77986 20.6436C2.5437 20.0637 2.42586 19.4426 2.43327 18.8165L2.44952 17.3703L1.41602 16.3595C0.968398 15.9221 0.612719 15.3997 0.369883 14.8228C0.127047 14.246 0.00195312 13.6265 0.00195312 13.0006C0.00195312 12.3748 0.127047 11.7553 0.369883 11.1784C0.612719 10.6016 0.968398 10.0792 1.41602 9.64177L2.45115 8.63102L2.43327 7.18477C2.42586 6.55874 2.5437 5.93755 2.77986 5.35772C3.01602 4.77789 3.36574 4.25114 3.80844 3.80844C4.25114 3.36574 4.77789 3.01602 5.35772 2.77986C5.93755 2.5437 6.55874 2.42586 7.18477 2.43327L8.63102 2.44952L9.64177 1.41602C10.0792 0.968398 10.6016 0.612719 11.1784 0.369883C11.7553 0.127047 12.3748 0.00195312 13.0006 0.00195312C13.6265 0.00195312 14.246 0.127047 14.8228 0.369883C15.3997 0.612719 15.9221 0.968398 16.3595 1.41602L15.1976 2.55027C14.9116 2.25742 14.5699 2.02472 14.1926 1.86585C13.8153 1.70697 13.41 1.62513 13.0006 1.62513C12.5913 1.62513 12.186 1.70697 11.8087 1.86585C11.4314 2.02472 11.0897 2.25742 10.8036 2.55027L9.30864 4.08427L7.16364 4.05827C6.75443 4.0537 6.34844 4.13095 5.9695 4.28549C5.59057 4.44003 5.24634 4.66874 4.95704 4.95819C4.66774 5.24764 4.43921 5.59199 4.28486 5.97101C4.13052 6.35002 4.05348 6.75606 4.05827 7.16527L4.08427 9.30702L2.55027 10.8036C2.25742 11.0897 2.02472 11.4314 1.86585 11.8087C1.70697 12.186 1.62513 12.5913 1.62513 13.0006C1.62513 13.41 1.70697 13.8153 1.86585 14.1926C2.02472 14.5699 2.25742 14.9116 2.55027 15.1976L4.08427 16.6926L4.05827 18.8376C4.0537 19.2469 4.13095 19.6529 4.28549 20.0318C4.44003 20.4107 4.66874 20.755 4.95819 21.0442C5.24764 21.3335 5.59199 21.5621 5.97101 21.7164C6.35002 21.8708 6.75606 21.9478 7.16527 21.943L9.30702 21.917L10.8036 23.451C11.0897 23.7439 11.4314 23.9766 11.8087 24.1354C12.186 24.2943 12.5913 24.3762 13.0006 24.3762C13.41 24.3762 13.8153 24.2943 14.1926 24.1354C14.5699 23.9766 14.9116 23.7439 15.1976 23.451L16.6926 21.917L18.8376 21.943C19.2469 21.9476 19.6529 21.8703 20.0318 21.7158C20.4107 21.5613 20.755 21.3325 21.0442 21.0431C21.3335 20.7536 21.5621 20.4093 21.7164 20.0303C21.8708 19.6513 21.9478 19.2452 21.943 18.836L21.917 16.6943L23.451 15.1976C23.7439 14.9116 23.9766 14.5699 24.1354 14.1926C24.2943 13.8153 24.3762 13.41 24.3762 13.0006C24.3762 12.5913 24.2943 12.186 24.1354 11.8087C23.9766 11.4314 23.7439 11.0897 23.451 10.8036L21.917 9.30864L21.943 7.16364C21.9476 6.75443 21.8703 6.34844 21.7158 5.9695C21.5613 5.59057 21.3325 5.24634 21.0431 4.95704C20.7536 4.66774 20.4093 4.43921 20.0303 4.28486C19.6513 4.13052 19.2452 4.05348 18.836 4.05827L16.6943 4.08427Z"
                fill="black"/>
        </g>
        <defs>
            <clipPath id="clip0_2212_1655">
                <rect width="26" height="26" fill="white"/>
            </clipPath>
        </defs>
    </svg>
)

const FailedPayIcon = () => (
    <svg width="250" height="250" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clipPath="url(#clip0_2212_1662)">
            <path
                d="M25 12.5C24 19 19.6274 24.5 13 24.5C5 23.5 3 20 1 12.5C3.5 4.5 6 3.5 13 1C21.5 3 23 6.5 25 12.5Z"
                fill="#ED4337"/>
            <path fillRule="evenodd" clipRule="evenodd"
                  d="M13.0625 9C13.278 9 13.4847 9.0856 13.637 9.23798C13.7894 9.39035 13.875 9.59701 13.875 9.8125V12.25H16.3125C16.528 12.25 16.7347 12.3356 16.887 12.488C17.0394 12.6403 17.125 12.847 17.125 13.0625C17.125 13.278 17.0394 13.4847 16.887 13.637C16.7347 13.7894 16.528 13.875 16.3125 13.875H13.875V16.3125C13.875 16.528 13.7894 16.7347 13.637 16.887C13.4847 17.0394 13.278 17.125 13.0625 17.125C12.847 17.125 12.6403 17.0394 12.488 16.887C12.3356 16.7347 12.25 16.528 12.25 16.3125V13.875H9.8125C9.59701 13.875 9.39035 13.7894 9.23798 13.637C9.0856 13.4847 9 13.278 9 13.0625C9 12.847 9.0856 12.6403 9.23798 12.488C9.39035 12.3356 9.59701 12.25 9.8125 12.25H12.25V9.8125C12.25 9.59701 12.3356 9.39035 12.488 9.23798C12.6403 9.0856 12.847 9 13.0625 9Z"
                  fill="black"/>
            <path
                d="M16.6943 4.08427L15.1976 2.55027L16.3595 1.41602L17.3703 2.45115L18.8165 2.43327C19.4426 2.42586 20.0637 2.5437 20.6436 2.77986C21.2234 3.01602 21.7501 3.36574 22.1928 3.80844C22.6355 4.25114 22.9853 4.77789 23.2214 5.35772C23.4576 5.93755 23.5754 6.55874 23.568 7.18477L23.5518 8.63102L24.5853 9.64177C25.0329 10.0792 25.3886 10.6016 25.6314 11.1784C25.8742 11.7553 25.9993 12.3748 25.9993 13.0006C25.9993 13.6265 25.8742 14.246 25.6314 14.8228C25.3886 15.3997 25.0329 15.9221 24.5853 16.3595L23.5501 17.3703L23.568 18.8165C23.5754 19.4426 23.4576 20.0637 23.2214 20.6436C22.9853 21.2234 22.6355 21.7501 22.1928 22.1928C21.7501 22.6355 21.2234 22.9853 20.6436 23.2214C20.0637 23.4576 19.4426 23.5754 18.8165 23.568L17.3703 23.5518L16.3595 24.5853C15.9221 25.0329 15.3997 25.3886 14.8228 25.6314C14.246 25.8742 13.6265 25.9993 13.0006 25.9993C12.3748 25.9993 11.7553 25.8742 11.1784 25.6314C10.6016 25.3886 10.0792 25.0329 9.64177 24.5853L8.63102 23.5501L7.18477 23.568C6.55874 23.5754 5.93755 23.4576 5.35772 23.2214C4.77789 22.9853 4.25114 22.6355 3.80844 22.1928C3.36574 21.7501 3.01602 21.2234 2.77986 20.6436C2.5437 20.0637 2.42586 19.4426 2.43327 18.8165L2.44952 17.3703L1.41602 16.3595C0.968398 15.9221 0.612719 15.3997 0.369883 14.8228C0.127047 14.246 0.00195312 13.6265 0.00195312 13.0006C0.00195312 12.3748 0.127047 11.7553 0.369883 11.1784C0.612719 10.6016 0.968398 10.0792 1.41602 9.64177L2.45115 8.63102L2.43327 7.18477C2.42586 6.55874 2.5437 5.93755 2.77986 5.35772C3.01602 4.77789 3.36574 4.25114 3.80844 3.80844C4.25114 3.36574 4.77789 3.01602 5.35772 2.77986C5.93755 2.5437 6.55874 2.42586 7.18477 2.43327L8.63102 2.44952L9.64177 1.41602C10.0792 0.968398 10.6016 0.612719 11.1784 0.369883C11.7553 0.127047 12.3748 0.00195312 13.0006 0.00195312C13.6265 0.00195312 14.246 0.127047 14.8228 0.369883C15.3997 0.612719 15.9221 0.968398 16.3595 1.41602L15.1976 2.55027C14.9116 2.25742 14.5699 2.02472 14.1926 1.86585C13.8153 1.70697 13.41 1.62513 13.0006 1.62513C12.5913 1.62513 12.186 1.70697 11.8087 1.86585C11.4314 2.02472 11.0897 2.25742 10.8036 2.55027L9.30864 4.08427L7.16364 4.05827C6.75443 4.0537 6.34844 4.13095 5.9695 4.28549C5.59057 4.44003 5.24634 4.66874 4.95704 4.95819C4.66774 5.24764 4.43921 5.59199 4.28486 5.97101C4.13052 6.35002 4.05348 6.75606 4.05827 7.16527L4.08427 9.30702L2.55027 10.8036C2.25742 11.0897 2.02472 11.4314 1.86585 11.8087C1.70697 12.186 1.62513 12.5913 1.62513 13.0006C1.62513 13.41 1.70697 13.8153 1.86585 14.1926C2.02472 14.5699 2.25742 14.9116 2.55027 15.1976L4.08427 16.6926L4.05827 18.8376C4.0537 19.2469 4.13095 19.6529 4.28549 20.0318C4.44003 20.4107 4.66874 20.755 4.95819 21.0442C5.24764 21.3335 5.59199 21.5621 5.97101 21.7164C6.35002 21.8708 6.75606 21.9478 7.16527 21.943L9.30702 21.917L10.8036 23.451C11.0897 23.7439 11.4314 23.9766 11.8087 24.1354C12.186 24.2943 12.5913 24.3762 13.0006 24.3762C13.41 24.3762 13.8153 24.2943 14.1926 24.1354C14.5699 23.9766 14.9116 23.7439 15.1976 23.451L16.6926 21.917L18.8376 21.943C19.2469 21.9476 19.6529 21.8703 20.0318 21.7158C20.4107 21.5613 20.755 21.3325 21.0442 21.0431C21.3335 20.7536 21.5621 20.4093 21.7164 20.0303C21.8708 19.6513 21.9478 19.2452 21.943 18.836L21.917 16.6943L23.451 15.1976C23.7439 14.9116 23.9766 14.5699 24.1354 14.1926C24.2943 13.8153 24.3762 13.41 24.3762 13.0006C24.3762 12.5913 24.2943 12.186 24.1354 11.8087C23.9766 11.4314 23.7439 11.0897 23.451 10.8036L21.917 9.30864L21.943 7.16364C21.9476 6.75443 21.8703 6.34844 21.7158 5.9695C21.5613 5.59057 21.3325 5.24634 21.0431 4.95704C20.7536 4.66774 20.4093 4.43921 20.0303 4.28486C19.6513 4.13052 19.2452 4.05348 18.836 4.05827L16.6943 4.08427Z"
                fill="black"/>
        </g>

    </svg>
)

export default VerifyPage;